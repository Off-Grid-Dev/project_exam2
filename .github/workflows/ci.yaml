name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v3

      - name: ğŸ§° Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ğŸ“¦ Install dependencies
        run: |
          npm ci || { echo "âŒ Dependency installation failed. Check your lockfile or registry access."; exit 10; }

      - name: âœ… Dependencies installed!
        if: success()
        run: echo "ğŸ“¦ Dependencies installed successfully."

      - name: ğŸ” Lint and Type Check
        run: |
          npm run lint || { echo "âŒ Linting failed. Code style issues detected."; exit 20; }
          npm run typecheck || { echo "âŒ Type check failed. TypeScript errors found."; exit 21; }

      - name: âœ… Lint and Type Check passed!
        if: success()
        run: echo "ğŸ¯ Code is clean and type-safe."

      - name: ğŸ§ª Run tests
        run: |
          npm run test || { echo "âŒ Tests failed. Review failing test cases and assertions."; exit 30; }

      - name: âœ… Tests passed!
        if: success()
        run: echo "ğŸ§ª All tests passed!"

      - name: ğŸš€ Build project
        run: |
          npm run build || { echo "âŒ Build failed. Check your bundler config or missing assets."; exit 40; }

      - name: âœ… Project build completed!
        if: success()
        run: echo "ğŸš€ Build successful and ready to deploy!"

      - name: ğŸ“Š Summary (on failure only)
        if: failure()
        run: |
          echo "ğŸ§¾ CI Summary:"
          echo "âŒ One or more steps failed. Here's what might have gone wrong:"
          echo "- ğŸ” Lint or Type Check: Code style or TypeScript errors"
          echo "- ğŸ§ª Tests: Failing assertions or broken mocks"
          echo "- ğŸš€ Build: Bundler issues or missing assets"
          echo ""
          echo "ğŸ’¡ Check the logs above for exact error messages and exit codes."
